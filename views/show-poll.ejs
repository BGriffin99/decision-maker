<!DOCTYPE html>
<html lang="en">

<head>
  <title>Voting Poll Page</title>

  <meta charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="/styles/main.css" />
  <link rel="stylesheet" href="/styles/layout.css" />
  <link rel="stylesheet" href="/styles/show-poll.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
  crossorigin="anonymous"/>

  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script defer src="/scripts/app.js"></script>
</head>

<body>
  <header>
    <div id="home-logo"><img src="images/arrows.png" alt="Arrows picture" id="logo-pic"/></div>
    <div id ="logo">Decision Maker</div>
  </header>

  <main class="container">
    <section class="vote-section">
      <form class="vote-form" method="POST" action="/polls/<%= submissionLink %>/vote" id="pollForm">
<!-- Vote question-->
        <div class="vote-question">
          <h1><%= title %></h1>
          <p>Rank your choices from best to worst by dragging and dropping the options</p>
        </div>
<!-- Vote options-->
        <div class="vote-set">
          <ol id="optionsList" class="list-group list-group-numbered">
            <% poll.forEach(function(item) { %>
              <li class="list-group-item" data-option-id="<%= item.choice_id %>"><%= item.choice_title %></li>
            <% }) %>
          </ol>
        </div>
<!-- Enter voters name -->
        <div class="form-floating mb-4">
          <input type="text" class="form-control" id="name" name="name" placeholder="">
          <label for="name">Name (optional)</label>
        </div>
<!-- Button to submit -->
          <input type="hidden" name="rankings" id="rankingsInput">
          <button type="submit" class="submit-button">Submit vote</button>
      </form>
    </section>
  </main>

<!-- Bootstrap CSS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"></script>
  <script>
    $(function() {
      $('#optionsList').sortable({
        axis: 'y',
        opacity: 0.8,
        cursor: 'move'
      });

      $('#pollForm').submit(function(event) {
        event.preventDefault();

        var rankings = $('#optionsList').sortable('toArray', {
          attribute: 'data-option-id'
        });

        // Set the value of the hidden input field
        $('#rankingsInput').val(rankings);

        // Submit the form
        $(this).unbind('submit').submit();
      });
    });
  </script>
</body>
</html>
