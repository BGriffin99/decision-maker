<!DOCTYPE html>
<html lang="en">
<head>
  <title>Decision Maker - <%= title %> Results</title>
  <%- include('partials/_header') %>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <header>
    <div id="home-logo"><img src="/images/arrows.png" alt="Arrows picture" id="logo-pic"/></div>
    <div id ="logo">Decision Maker</div>
  </header>
    <main class="container">
      <section class="vote-section">
        <form class="vote-form">
  <!-- Vote question -->
          <div class="vote-question">
            <h1><%= title %></h1>
            <p>The voting results are shown in the chart below</p>
          </div>
  <!-- Vote result -->
          <div class="result-vote">
            <div id="chart_div" style="width: 100%; height: 500px;"></div>
            <script type="text/javascript">
              google.charts.load('current', {'packages':['corechart']});
              google.charts.setOnLoadCallback(drawChart);
              function drawChart() {
                let data = new google.visualization.DataTable();
                data.addColumn('string', 'Choice');
                data.addColumn('number', 'Score');
                data.addColumn({type: 'string', role: 'tooltip'});

                <% poll.forEach(function(choice) { %>
                  data.addRow(['<%= choice.choice %>', <%= choice.score %>, '<%= choice.score %> Score -- <%= choice.vote_counts %> Votes']);
                <% }); %>

                let options = {
                  bars: 'horizontal',
                  legend: {position: 'none'},
                  tooltip: {isHtml: true}
                };

                let chart = new google.visualization.BarChart(document.getElementById('chart_div'));
                chart.draw(data, options);
              }
            </script>
            <small>Scoring is based on the Modified Borda count. Any unranked options receive 0 points, the lowest ranked receives 1, the next-lowest receives 2, etc., up to a possible maximum of n points for the highest ranked option. In case of a tie, the tiebreak is given to the option with the most highest ranked votes.</small>
          </div>
        </form>
      </section>
    </main>
    <%- include('partials/_footer') %>
</body>
</html>
